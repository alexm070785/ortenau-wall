<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#e7e7e7">
<title>Ortenau liefert ¬∑ Detail</title>
<style>
  :root{ --accent:#e7e7e7; --text:#333; --bg:#f6f6f6; --card:#fff; --border:#d0d0d0; --muted:#70798C; --shadow:0 4px 12px rgba(0,0,0,.08); --radius:14px; --badge:#f2f2f2; --tap:48px; --mono: ui-monospace, Menlo, Monaco, Consolas, "Courier New", monospace }
  *{box-sizing:border-box}
  html{font-size:16px}
  @media (max-width:480px){ html{font-size:17px} }
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
  header{position:sticky;top:0;background:var(--accent);border-bottom:1px solid #b0b0b0;z-index:5}
  .head{max-width:1200px;margin:auto;display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 16px}
  .head img{height:48px}
  a.back{display:inline-flex;align-items:center;gap:8px;text-decoration:none;color:#222;border:1px solid var(--border);background:#fff;padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);min-height:var(--tap)}
  a.back:active{transform:scale(.99)}
  main{max-width:1100px;margin:18px auto;padding:0 16px;display:grid;gap:16px;grid-template-columns:2fr 1fr}
  @media (max-width:900px){ main{grid-template-columns:1fr} }
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  h1{margin:0 0 8px;font-size:clamp(1.2rem, 1rem + 1.5vw, 1.8rem)}
  .muted{color:var(--muted)}
  .badge{display:inline-block; background:var(--badge); border:1px solid var(--border); border-radius:999px; padding:4px 10px; font-size:.9rem; margin-right:6px}
  .section h2{margin:0 0 8px;font-size:1.05rem}
  .kv{display:grid;grid-template-columns:140px 1fr;gap:6px}
  .kv div{padding:4px 0}
  @media (max-width:560px){ .kv{grid-template-columns:1fr} .kv div:first-child{font-weight:600} }
  .links a{display:inline-flex;align-items:center;justify-content:center;min-height:var(--tap);margin:6px 6px 0 0;text-decoration:none;border:1px solid var(--border);border-radius:999px;padding:8px 12px;background:#fff}
  .hero{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
  .emoji-hero{font-size:64px;line-height:1;display:flex;align-items:center;justify-content:center;width:120px;height:120px;border-radius:16px;border:1px solid var(--border);background:#fff}
  @media (max-width:480px){ .emoji-hero{font-size:56px;width:100px;height:100px} }
  .cta-bar{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .cta-bar a{display:inline-flex;align-items:center;justify-content:center;min-height:var(--tap);padding:10px 14px;border-radius:12px;text-decoration:none;border:1px solid var(--border);background:#fff}

  /* Speisekarte kompakt */
  details.menu{margin-top:14px}
  details.menu summary{cursor:pointer;list-style:none;display:flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;user-select:none}
  details.menu summary::-webkit-details-marker{display:none}
  .menu-body{margin-top:10px}
  .menu-item{background:#fff;border:1px solid #eee;border-radius:10px;padding:8px 10px;margin-bottom:6px}
  .menu-head{font-weight:700;margin:10px 0 6px}
  .menu-text{white-space:pre-wrap;font-family:var(--mono)}
  .note{font-size:.95rem;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<header>
  <div class="head">
    <a class="back" href="index.html" aria-label="Zur √úbersicht">‚Üê Zur √úbersicht</a>
    <img src="header.png" alt="Ortenau liefert" height="48">
  </div>
</header>

<main>
  <article class="card" id="detail">
    <div class="hero">
      <div id="emoji" class="emoji-hero" aria-hidden="true">üçΩÔ∏è</div>
      <div>
        <h1 id="titel">Lokal</h1>
        <div id="kategorie" class="badge">Kategorie</div>
        <div id="badges" style="margin-top:6px"></div>
        <div id="ort" class="muted" style="margin-top:4px"></div>
        <div class="cta-bar" id="ctaBar"></div>
      </div>
    </div>

    <section class="section" id="sec-hours" style="margin-top:14px">
      <h2>√ñffnungszeiten & Hinweise</h2>
      <div class="kv">
        <div class="muted">√ñffnungszeiten</div><div id="oeffnungszeiten">‚Äì</div>
        <div class="muted">Schlie√ütage</div><div id="schliesstage">‚Äì</div>
      </div>
    </section>

    <section class="section" id="sec-contact" style="margin-top:14px">
      <h2>Kontakt & Adresse</h2>
      <div class="kv" id="kv-contact">
        <div class="muted">Adresse</div><div id="adresse">‚Äì</div>
        <div class="muted">Telefon</div><div id="telefon">‚Äì</div>
        <div class="muted">E-Mail</div><div id="email">‚Äì</div>
      </div>
    </section>

    <section class="section" id="sec-desc" style="margin-top:14px">
      <h2>Beschreibung</h2>
      <div id="beschreibung">‚Äì</div>
    </section>

    <!-- SPEISEKARTE -->
    <details class="menu section" id="sec-menu">
      <summary>üçΩÔ∏è Speisekarte anzeigen / ausblenden</summary>
      <div class="menu-body" id="menuBody"></div>
      <div class="note" id="priceNote" style="display:none">Hinweis: Wir nennen hier bewusst keine Preise, da sich diese bei den Anbietern h√§ufig √§ndern.</div>
    </details>
  </article>

  <aside class="card" id="sec-links">
    <h2 style="margin:0 0 8px">Links</h2>
    <div class="links" id="links"></div>
  </aside>
</main>

<script>
function getParam(name){ const u = new URL(location.href); return u.searchParams.get(name); }
function textOrEmpty(v){ return v && String(v).trim() ? v : ""; }
function esc(s){ return (s||'').replace(/[&<>\"']/g, m=>({"&":"&amp;","<":"&lt;"," >":"&gt;","\"":"&quot;"}[m] || m)); }
function telLink(num){ const n=(num||"").replace(/\s+/g,''); return n ? `tel:${encodeURIComponent(n)}` : ""; }
function mailLink(m){ return m ? `mailto:${encodeURIComponent(m)}` : ""; }

function catEmoji(cat){
  const c = (cat||'').toLowerCase();
  if (c.includes('doener') || c.includes('d√∂ner') || c.includes('kebab')) return 'ü•ô';
  if (c.includes('salat')) return 'ü•ó';
  if (c.includes('pizza') || c.includes('pizzeria')) return 'üçï';
  if (c.includes('getr√§nk') || c.includes('drinks') || c.includes('trinken')) return 'ü•§';
  if (c.includes('cafe') || c.includes('caf√©')) return '‚òïÔ∏è';
  return 'üçΩÔ∏è';
}

// Speisekarte zu Bl√∂cken
function renderMenuBlocks(raw){
  const body = document.getElementById('menuBody');
  body.innerHTML = '';
  if(!raw || !raw.trim()){ document.getElementById('sec-menu').style.display = 'none'; return; }

  const lines = raw.replace(/\r\n/g,"\n").split("\n");
  const headRe = /^[\u{1F300}-\u{1FAFF}]/u;
  let buffer = [], haveAny = false;

  function addHead(t){
    const h = document.createElement('div');
    h.className = 'menu-head';
    h.textContent = t;
    body.appendChild(h);
  }
  function addItem(text){
    const d = document.createElement('div');
    d.className = 'menu-item';
    d.innerHTML = `<div class="menu-text">${esc(text)}</div>`;
    body.appendChild(d);
    haveAny = true;
  }
  function flush(){ const t = buffer.join("\n").trim(); if(t) addItem(t); buffer = []; }

  for(let i=0;i<lines.length;i++){
    const l = lines[i].trim();
    if(!l){ flush(); continue; }
    const isHead = headRe.test(l) || (!/[0-9‚Ç¨]/.test(l) && l.length < 60 && buffer.length===0);
    if(isHead){ flush(); addHead(l); continue; }
    const nx = lines[i+1]?.trim() || "";
    const looksPrice = /‚Ç¨|\d,\d{2}/.test(nx);
    if(!/‚Ç¨|\d,\d{2}/.test(l) && looksPrice){ buffer.push(l); buffer.push(nx); i++; flush(); }
    else { buffer.push(l); flush(); }
  }
  flush();
  if (haveAny) document.getElementById('priceNote').style.display = 'block';
}

(async function(){
  const id = getParam('id');
  const q  = getParam('q');
  const res = await fetch('/api/entries');
  const data = await res.json();

  let item = null;
  if (id) item = data.find(x => x.id === id);
  if (!item && q) item = data.find(x => (x.titel||'').toLowerCase().includes(q.toLowerCase()));
  if (!item) { document.getElementById('detail').innerHTML = '<p class="muted">Eintrag nicht gefunden.</p>'; return; }

  // Emoji-Hero
  document.getElementById('emoji').textContent = catEmoji(item.kategorie);

  const ort = item.stadt || item?.adresse?.stadt || '';
  let catLabel = (item.kategorie||'').toLowerCase();
  if (c
