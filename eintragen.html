<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ortenau liefert · Speisekarte eintragen</title>
<style>
  :root{
    --accent:#e7e7e7; --text:#4f4f4f; --bg:#f6f6f6; --card:#fff;
    --muted:#70798C; --radius:12px; --shadow:0 4px 12px rgba(0,0,0,.08);
    --shadowHover:0 6px 18px rgba(0,0,0,.12);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:var(--bg);color:var(--text);padding-bottom:40px;}
  .visually-hidden{position:absolute!important;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}

  header.site{position:sticky;top:0;z-index:100;background:var(--accent);border-bottom:1px solid #b0b0b0;}
  .head{max-width:1360px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:14px 16px;}
  .hamburger{display:inline-flex;align-items:center;justify-content:center;width:46px;height:40px;border-radius:8px;background:var(--accent);border:0;cursor:pointer}
  .hamburger:hover{background:#FFB2B3}
  .hamburger svg{width:28px;height:28px;display:block}

  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.25);opacity:0;pointer-events:none;transition:opacity .2s;z-index:99}
  .backdrop.show{opacity:1;pointer-events:auto}
  .drawer{position:fixed;top:0;right:-280px;width:280px;height:100%;background:#f6f6f6;border-left:1px solid #d9d9d9;box-shadow:-12px 0 24px rgba(0,0,0,.18);transition:right .25s;z-index:100;display:flex;flex-direction:column}
  .drawer.show{right:0}
  .drawer header{background:var(--accent);border-bottom:1px solid #b0b0b0}
  .menu{padding:10px 12px;display:flex;flex-direction:column;gap:6px}
  .menu a{text-decoration:none;color:var(--text);padding:10px 12px;border-radius:8px;display:block;transition:background .15s}
  .menu a:hover{background:#FFB2B3}
  .menu a.active{background:#f6f6f6}

  .toolbar{
    max-width:1360px;margin:8px auto 0;
    display:flex;align-items:center;gap:12px;
    padding:0 16px;justify-content:space-between;
  }
  .search-wrap{
    position:relative;display:flex;align-items:center;
    flex:1 1 420px; max-width:720px;
  }
  .search-wrap svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);pointer-events:none}
  #search{width:100%;padding:10px 38px 10px 36px;border:1px solid #d0d0d0;border-radius:10px;background:#fff;color:var(--text);}
  #clearBtn{position:absolute;right:6px;top:50%;transform:translateY(-50%);width:28px;height:28px;border:0;border-radius:50%;cursor:pointer;background:#f6f6f6;}
  #clearBtn:hover{background:#eaeaea}

  .cta{
    flex:0 0 auto;
    display:inline-flex;align-items:center;gap:10px;
    padding:10px 14px;border-radius:10px;
    background:#fff;border:1px solid #d0d0d0; text-decoration:none; color:var(--text);
    box-shadow:var(--shadow); transition:transform .15s, box-shadow .15s, background .15s;
  }
  .cta:hover{transform:translateY(-1px); box-shadow:var(--shadowHover); background:#f9f9f9;}
  .cta .plus{
    width:22px;height:22px;display:inline-block;background:#4f4f4f;border-radius:6px;
    -webkit-mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 5h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></svg>') no-repeat center / contain;
            mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 5h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></svg>') no-repeat center / contain;
  }
  @media (max-width:480px){ .cta .txt{display:none;} }

  .form-wrap{max-width:960px;margin:16px auto 24px;padding:0 16px;}
  .form-card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);padding:18px;}
  .form-card h2{margin:0 0 10px 0; font-size:1.25rem;}
  .sub{color:var(--muted); margin-bottom:14px;}

  form .row{display:grid; gap:12px; grid-template-columns:1fr;}
  @media(min-width:720px){
    form .row2{grid-template-columns:1fr 1fr;}
    form .row3{grid-template-columns:1fr 1fr 1fr;}
    form .row4{grid-template-columns:1fr 1fr 1fr 1fr;}
  }
  label{font-weight:600; display:block; margin-bottom:6px;}
  .req::after{content:" *"; color:#d33; font-weight:700;}
  input[type="text"], input[type="tel"], input[type="number"], input[type="file"], select, textarea, .time{
    width:100%; padding:10px 12px; border:1px solid #d0d0d0; border-radius:10px; background:#fff; color:var(--text); outline:none;
  }
  textarea{min-height:100px; resize:vertical;}
  .hint{color:var(--muted); font-size:.9rem; margin-top:4px;}
  .inline{display:flex; align-items:center; gap:8px;}
  .badge{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid #e1e1e1; border-radius:999px; background:#fff;}
  .dot{width:12px; height:12px; border-radius:50%; display:inline-block;}

  .drop{border:2px dashed #d0d0d0; border-radius:12px; padding:14px; text-align:center; background:#fafafa;}
  .drop.dragover{background:#f0f7ff; border-color:#7aa7ff;}
  .preview{display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:10px; margin-top:10px;}
  .thumb{position:relative; border:1px solid #e1e1e1; border-radius:10px; overflow:hidden; background:#fff;}
  .thumb img{display:block; width:100%; height:100%; object-fit:cover; aspect-ratio:1/1;}
  .thumb button{position:absolute; top:6px; right:6px; border:0; border-radius:8px; background:#fff; padding:4px 7px; cursor:pointer; box-shadow:var(--shadow);}
  .thumb button:hover{box-shadow:var(--shadowHover);}

  .hours{border:1px solid #e1e1e1; border-radius:10px; overflow:hidden;}
  .hours table{width:100%; border-collapse:collapse;}
  .hours th, .hours td{border-bottom:1px solid #eee; padding:8px 10px; text-align:left; font-size:.95rem;}
  .hours tr:last-child td{border-bottom:none;}
  .hours .time{max-width:140px;}

  .actions{display:flex; gap:10px; justify-content:flex-end; margin-top:14px;}
  .btn{padding:10px 14px; border-radius:10px; border:1px solid #d0d0d0; background:#fff; cursor:pointer; box-shadow:var(--shadow);}
  .btn.primary{background:#4f4f4f; color:#fff; border-color:#4f4f4f;}
  .btn.primary:hover{filter:brightness(1.05);}
  .btn:hover{box-shadow:var(--shadowHover);}

  .toast{position:fixed; right:16px; bottom:56px; background:#2d7a3e; color:#fff; padding:12px 14px; border-radius:10px; box-shadow:var(--shadow); opacity:0; transform:translateY(8px); transition:all .25s;}
  .toast.show{opacity:1; transform:translateY(0);}

  footer{position:fixed;bottom:0;left:0;width:100%;height:40px;background:var(--accent);color:#595959;border-top:1px solid #b0b0b0;font-size:.9rem}
  .footer-inner{max-width:1360px;margin:0 auto;height:100%;display:flex;justify-content:center;align-items:center;padding:0 12px}
</style>
</head>
<body>
<header class="site">
  <div class="head">
    <a href="index.html" aria-label="Zur Startseite von Ortenau liefert">
      <img src="header.png" alt="Ortenau liefert Logo" height="68">
    </a>
    <h1 class="visually-hidden">Ortenau liefert – Speisekarte eintragen</h1>
    <button class="hamburger" id="menuBtn" aria-label="Menü öffnen" aria-expanded="false" aria-controls="drawer">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#4f4f4f" d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/></svg>
    </button>
  </div>
</header>

<div class="backdrop" id="backdrop" hidden></div>
<aside class="drawer" id="drawer" role="dialog" aria-modal="true" aria-hidden="true">
  <header>
    <div class="head" style="max-width:none;padding:10px 12px;">
      <strong>Menü</strong>
      <button class="hamburger" id="closeBtn" aria-label="Menü schließen">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#4f4f4f" d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
      </button>
    </div>
  </header>
  <nav class="menu">
    <a href="index.html">Start</a>
    <a href="eintragen.html">Eintragen</a>
    <a href="info.html">Info</a>
    <a href="kontakt.html">Kontakt</a>
    <a href="about.html">Über uns</a>
    <hr style="border:none;border-top:1px solid #dcdcdc;margin:8px 0">
    <a href="impressum.html">Impressum</a>
    <a href="datenschutz.html">Datenschutz</a>
    <a href="agb.html">AGB</a>
  </nav>
</aside>

<div class="toolbar">
  <div class="search-wrap" role="search">
    <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="#9a9a9a" d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.57-4.23C16 6.01 13.99 4 11.5 4S7 6.01 7 9.5 9.01 15 11.5 15c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-4 0C9.01 14 7 11.99 7 9.5S9.01 5 11.5 5 16 7.01 16 9.5 13.99 14 11.5 14z"/></svg>
    <input id="search" type="search" placeholder="Suche z. B. „Pizzeria Offenburg“" aria-label="Suche">
    <button id="clearBtn" type="button" aria-label="Suche leeren">×</button>
  </div>

  <a class="cta" href="eintragen.html" aria-current="page">
    <span class="plus" aria-hidden="true"></span>
    <span class="txt">Trage deine Speisekarte ein</span>
  </a>
</div>

<main>
  <div class="form-wrap">
    <div class="form-card">
      <h2>Speisekarte eintragen</h2>
      <div class="sub">Bitte fülle die folgenden Felder aus. <span class="req"></span> kennzeichnet Pflichtfelder.</div>

      <form id="entryForm" enctype="multipart/form-data" novalidate>
        <div class="row row2">
          <div>
            <label for="name" class="req">Name des Lokals (Restaurant, Döner, Pizzeria)</label>
            <input id="name" name="name" type="text" placeholder="z. B. Pizzeria Bella Italia" required>
          </div>

          <div>
            <label for="category" class="req">Kategorie</label>
            <select id="category" name="category" required>
              <option value="" disabled selected>Bitte wählen…</option>
              <option value="doener">Döner</option>
              <option value="restaurant">Restaurant</option>
              <option value="pizzeria">Pizzeria</option>
            </select>
            <div class="hint inline" id="catHint">
              <span class="badge"><span class="dot" id="dot"></span><span id="dotLabel">Kategorie-Farbe</span></span>
            </div>
          </div>
        </div>

        <div class="row row4">
          <div>
            <label for="plz" class="req">PLZ</label>
            <input id="plz" name="plz" type="text" inputmode="numeric" pattern="\d{4,5}" placeholder="z. B. 77652" required aria-describedby="plzhint">
            <div id="plzhint" class="hint">4–5-stellig</div>
          </div>
          <div>
            <label for="ort" class="req">Ort</label>
            <input id="ort" name="ort" type="text" placeholder="z. B. Offenburg" required>
          </div>
          <div>
            <label for="strasse" class="req">Straße</label>
            <input id="strasse" name="strasse" type="text" placeholder="z. B. Hauptstraße" required>
          </div>
          <div>
            <label for="hausnr">Hausnr.</label>
            <input id="hausnr" name="hausnr" type="text" placeholder="z. B. 12a">
          </div>
        </div>

        <div class="row row2">
          <div>
            <label for="tel">Telefon (optional)</label>
            <input id="tel" name="tel" type="tel" placeholder="+49 …">
          </div>
          <div>
            <label for="website">Webseite (optional)</label>
            <input id="website" name="website" type="text" placeholder="https://…">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Öffnungszeiten (optional)</label>
            <div class="hours" aria-label="Öffnungszeiten pro Wochentag">
              <table>
                <thead><tr><th>Tag</th><th>von</th><th>bis</th><th>Ruhetag</th></tr></thead>
                <tbody id="hoursBody"></tbody>
              </table>
            </div>
            <div class="hint">Lass Zeiten leer oder wähle „Ruhetag“, wenn geschlossen.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="menuImages" class="req">Bilder der Speisekarte</label>
            <div class="drop" id="dropImgs" aria-describedby="imgHint">
              <input id="menuImages" name="menuImages" type="file" accept="image/*" multiple required>
              <div>Bilder auswählen oder hierher ziehen</div>
            </div>
            <div id="imgHint" class="hint">Mehrere Bilder möglich. Mindestens 1 Bild erforderlich.</div>
            <div class="preview" id="imgPreview" aria-live="polite"></div>
          </div>
        </div>

        <div class="row">
          <div class="hint">
            Mit dem Absenden bestätigst du, dass du die Rechte an den hochgeladenen Bildern besitzt und unsere Datenschutzbestimmungen akzeptierst.
          </div>
        </div>

        <div class="actions">
          <button type="reset" class="btn">Zurücksetzen</button>
          <button type="submit" class="btn primary">Eintrag senden</button>
        </div>
      </form>
    </div>
  </div>
</main>

<footer><div class="footer-inner">© <span id="jahr"> </span> Ortenau-Liefert</div></footer>
<div class="toast" id="toast" role="status" aria-live="polite">Danke! Dein Eintrag wurde übermittelt.</div>

<script>
/* ... alles oberhalb bleibt wie bei dir ... */

/* ===== Formular-Submit -> Netlify Function (ein Bild, 8 MB) ===== */
(function(){
  const form  = document.getElementById('entryForm');
  const toast = document.getElementById('toast');
  if (!form) return;

  function showToast(text, color){
    toast.textContent = text;
    if(color) toast.style.background = color;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 4000);
  }

  function collectHoursJSON(){
    const rows = document.querySelectorAll('#hoursBody tr');
    const hours = [];
    rows.forEach((row, i)=>{
      const open = row.querySelector(`input[name="open_${i}"]`)?.value || "";
      const close = row.querySelector(`input[name="close_${i}"]`)?.value || "";
      const closed = row.querySelector(`input[name="closed_${i}"]`)?.checked || false;
      hours.push({ day:i, open, close, closed });
    });
    return JSON.stringify(hours);
  }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if (!form.checkValidity()) return form.reportValidity();

    const menuImages = document.getElementById('menuImages');
    if(!menuImages.files || menuImages.files.length === 0){
      return showToast("Bitte mindestens ein Bild der Speisekarte auswählen.", "#c0392b");
    }

    // Nur 1 Bild + 8MB Limit
    const first = menuImages.files[0];
    const MAX_MB = 8;
    if (first.size > MAX_MB * 1024 * 1024) {
      return showToast(`Bild ist zu groß (>${MAX_MB} MB). Bitte kleineres Bild.`, "#c0392b");
    }

    const fd = new FormData();
    fd.set('name',     document.getElementById('name').value.trim());
    fd.set('category', document.getElementById('category').value);
    fd.set('ort',      document.getElementById('ort').value.trim());
    fd.set('strasse',  document.getElementById('strasse').value.trim());
    fd.set('hausnr',   document.getElementById('hausnr').value.trim());
    fd.set('plz',      document.getElementById('plz').value.trim());
    // optional:
    // fd.set('menuText', '');

    // nur EIN Bild anhängen
    fd.append('menuImages', first, first.name);

    // optionale Felder
    fd.set('website', document.getElementById('website').value.trim());
    fd.set('phone',   document.getElementById('tel').value.trim());
    fd.set('hours_json', collectHoursJSON());

    try{
      showToast("Wird gesendet…", "#666");
      const res = await fetch('/.netlify/functions/entries-create', { method:'POST', body: fd });
      const data = await res.json().catch(()=> ({}));
      if(!res.ok) throw new Error(data?.error || ('HTTP '+res.status));

      showToast("Danke! Dein Eintrag wurde gespeichert (ID: " + data.id + ")", "#2d7a3e");
      form.reset();
      document.getElementById('imgPreview').innerHTML='';
      document.getElementById('category').dispatchEvent(new Event('change'));
      document.querySelectorAll('#hoursBody .closed').forEach(cb=>cb.dispatchEvent(new Event('change')));
    }catch(err){
      console.error(err);
      showToast("Fehler: " + err.message, "#c0392b");
    }
  });
})();
</script>

</body>
</html>
